#ifndef INDEX_MIN_H
#define INDEX_MIN_H

#include <Arduino.h>

#include "html/index.h"

namespace html
{
  constexpr char index_min[] PROGMEM =
R"%(<!DOCTYPE html><html lang="fr"><head><meta charset="utf-8"><title>RBR Magnac | )%" VERSION R"%(</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@200..900&family=Inria+Sans:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet"><style>:root{--bg:hsl(180, 100%, 90%);--good:hsl(135,  90%, 30%);--bad:hsl(  0,  90%, 30%);--sky:#0005}body{font-family:"Inria Sans",Ubuntu,sans-serif;font-size:1em;width:calc(100% - 60px);margin:auto;margin-bottom:50px;background-color:var(--bg);background-image:radial-gradient(circle at 30px 30px,#fff 0,#ff8 10%,var(--bg) 50%);background-attachment:fixed;color:#111}menu{position:absolute;top:10px;right:20px;padding:10px}menu li{list-style:none}menu li a{display:inline-block;padding:5px;text-decoration:none}menu li a::after{content:"\00a0üóíÔ∏è"}menu li a:hover{background:#0002}h1{margin-top:20px;background:linear-gradient(to right,#f80 0,#840 35%,#000 100%);background-clip:text;color:transparent}.version{font-size:66%;font-family:Inconsolata,monospace;opacity:50%;margin-left:5px}label{display:inline-block;width:170px}label::after{content:"\00a0: "}b{font-family:Inconsolata,monospace;font-weight:700}b input{font:inherit;background:#fff8;border:0;border-bottom:1px solid #0008}#heures_hphc.hc::after{content:" ‚úì"}#heures_hphc.hc,.eco_hp{color:var(--good)}.cumul,.eco_hc{color:var(--bad)}#radiateur{margin-left:auto;margin-right:20px}#is_on_radi.off{color:var(--bad)}#is_on_radi.off::after{content:" ‚ùå"}#is_on_radi.on{color:var(--good)}#is_on_radi.on::after{content:" ‚úì"}canvas{margin-top:30px}.flex-container{display:flex;flex-wrap:wrap;justify-content:space-between}.box h2,.box h3{margin:-10px;margin-bottom:10px;padding:10px;background:var(--sky);border-radius:5px 5px 0 0;color:#fff;font-size:1.3em}.box{background:#fff5;padding:10px;box-shadow:0 0 8px #000000aa;margin-top:20px;border-radius:5px;backdrop-filter:blur(10px)}#instant{margin-right:20px}#instant label{width:120px}#instant h2::before{content:"‚ö°\00a0"}#radiateur h2::before{content:"üîå\00a0"}#control h2::before{content:"‚öôÔ∏è\00a0\00a0"}#donnees_conso::before{content:"üìà\00a0"}#heures_hphc::before{content:"üïò\00a0"}#ota.disabled{display:none}#ota.enabled{backdrop-filter:blur(5px);color:#fff;display:block;position:fixed;top:20px;left:20px;right:20px;z-index:1000;background:#000000aa}#ota h2{padding:20px;text-align:center}#ota_text{display:block;text-align:center}#ota_progress{width:calc(100% - 40px);margin:20px;height:20px;border:1px solid #ededf0}</style><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><script>(()=>{window.Magnac={},window.byId=document.getElementById.bind(document);let s=!1;document.addEventListener("DOMContentLoaded",()=>{let e=["24h","1h","15min"];function o(e,t){var n=e.slice(0,t);return e.slice(t,e.length).concat(n)}function a(e){var t=(e=Math.floor(e/100))%100,n=(e=Math.floor(e/100),e=>String(e).padStart(2,"0"));return n(e)+" h "+n(t)}Magnac.prix_hp=2874,Magnac.prix_hc=2088,Magnac.chtconso={},Magnac.data={},Chart.defaults.font.size=14,e.forEach(function(e){Magnac.chtconso[e]=new Chart(byId("pltconso_"+e),{type:"line",data:[],options:{scales:{y:{suggestedMin:0,title:{display:!0,text:"Puissance (W)"}}}}})});let r=["force_off","force_on","hc_on","force_off_radi","force_on_radi"];function t(e){var t=e.currentTarget.checked,e=e.currentTarget.name+"="+t;r.forEach(e=>byId(e).disabled=!0),console.log(e),fetch("/control?"+e).then(e=>{if(!e.ok)throw new Error("control HTTP"+e.status)})}function l(e,n){return e.reduce((e,t)=>e+t*n)}r.forEach(e=>byId(e).addEventListener("change",t)),byId("seuil").addEventListener("change",function(e){var t=e.currentTarget.name,e=e.currentTarget.value;fetch("/control?"+(t+"="+e)).then(e=>{if(!e.ok)throw new Error("seuil HTTP"+e.status)})});let h=e=>e.map(e=>Math.max(e,0));function n(){Magnac.prix_hp=parseInt(byId("ekWh_hp").value),Magnac.prix_hc=parseInt(byId("ekWh_hc").value),e.forEach(i)}byId("ekWh_hp").addEventListener("change",n),byId("ekWh_hc").addEventListener("change",n);let c={};function i(s){fetch("/chart?"+s).then(e=>{if(e.ok)return e.json();throw new Error(s+" HTTP"+e.status)}).then(function(c){var n;t=s,(n=c).p1_hc=n.p1_hc.map(e=>-e),n.p1_hp=n.p1_hp.map(e=>-e),e=(Magnac.data[t]=n).p1_hc.map((e,t)=>e+n.p1_hp[t]),a=n.p2_hc.map((e,t)=>e+n.p2_hp[t]),Magnac.data[t].p1=e,Magnac.data[t].p2=a,c=n;let i=[];["hp","hc"].forEach(e=>{var t=l(h(c["p2_"+e]),c.res)/36e5,n=Magnac["prix_"+e],a=t*n/1e4,o=(byId(`cumul_${e}_`+s).innerHTML=`${t.toFixed(3)} kWh &times; 0.${n} ‚Ç¨/kWh = <span class="cumul">${a.toFixed(2)} ‚Ç¨</span>`,h(c["p1_"+e])),o=l(o,c.res)/36e5,r=o*n/1e4;i.push({cumul:t,euro:a,total:o}),byId(`eco_${e}_`+s).innerHTML=`${o.toFixed(3)} kWh &times; 0.${n} ‚Ç¨/kWh = <span class="eco_${e}">${r.toFixed(2)} ‚Ç¨</span>`});var e=i[0].cumul+i[1].cumul,t=i[0].euro+i[1].euro,a=(byId("cumul_tot_"+s).innerHTML=`${e.toFixed(3)} kWh, <span class="cumul">${t.toFixed(2)} ‚Ç¨</span>`,e+i[0].total),t=1-e/a||0,e=(byId("autoconso_"+s).innerHTML=`1 - ${e.toFixed(3)}/${a.toFixed(3)} = <span class="eco_hp">${(100*t).toFixed(2)} %</span>`,((n,a)=>{let o=new Date;return a*=1e3,[...Array(n).keys()].map(function(e){var t=new Date;return t.setTime(o.getTime()+(e-n)*a),t.toLocaleString("fr-FR").split(" ")[1]})})(c.p2.length,c.res));Magnac.chtconso[s].data={labels:e,datasets:[{label:"Consommation/surplus HP (W)",data:o(c.p2_hp,c.ix),pointStyle:!1,borderColor:"#36a2eb",fill:{target:"origin",above:"#ff000044",below:"#00ff0044"}},{pointStyle:!1,borderColor:"#cf0911",label:"Chauffe-eau HP (W)",data:o(c.p1_hp,c.ix)},{label:"Consommation HC (W)",data:o(c.p2_hc,c.ix),pointStyle:!1,borderColor:"#7a49a5",fill:{target:"origin",above:"#7a49a544",below:"#00ff0044"}},{pointStyle:!1,borderColor:"#ff8800",label:"Chauffe-eau HC (W)",data:o(c.p1_hc,c.ix)}]},Magnac.chtconso[s].update("none")}).catch(function(e){console.error(e)}).finally(function(e){setTimeout(i,c[s],s)})}c["24h"]=18e4,c["1h"]=8e3,c["15min"]=2e3,function t(){var n=!1;fetch("/ota").then(function(e){if(e.ok)return e.json();throw new Error("ota HTTP "+e.status)}).then(function(e){Magnac.ota=e,byId("last_boot").innerHTML=new Date(1e3*e.last_boot).toLocaleString("fr-FR"),byId("ota_progress").setAttribute("value",e.progress),byId("ota_text").textContent=e.progress+" %",e.updating?(s=!0,byId("ota").classList.toggle("disabled",!1),byId("ota").classList.toggle("enabled",!0),n=!0):s&&(n=!1,setTimeout(()=>window.location.reload(),3e3))}).catch(function(e){console.error(e)}).finally(function(e){setTimeout(t,n?500:3e3)})}(),function t(){fetch("/watts").then(function(e){if(e.ok)return e.json();throw new Error("watts HTTP "+e.status)}).then(function(e){Magnac.watts=e,byId("p1").innerHTML=-Math.round(e.power1)+" W",byId("p2").innerHTML=Math.round(e.power2)+" W";var t=e.power2-e.power1;Magnac.dimmer?.hc_on&&(t=e.power2),byId("ptot").innerHTML=Math.round(t)+" W"}).catch(function(e){console.error(e)}).finally(function(e){setTimeout(t,2e3)})}(),function t(){fetch("/dimmer").then(e=>{if(e.ok)return e.json();throw new Error("dimmer HTTP "+e.status)}).then(function(t){Magnac.dimmer=t,r.forEach(e=>byId(e).checked=t[e]),byId("seuil")!==document.activeElement&&(byId("seuil").value=t.seuil);var e=byId("is_on_radi");e.innerHTML="normalement "+(t.is_on_radi?"allum√©":"√©teint"),e.classList.toggle("on",t.is_on_radi),e.classList.toggle("off",!t.is_on_radi);(e=byId("heures_hphc")).innerHTML=a(t.start_hc)+` ‚Äì¬≠`+a(t.end_hc);var n=t.start_hc<=t.time&&t.time<t.end_hc;e.classList.toggle("hc",n)}).catch(function(e){console.error(e)}).finally(function(e){setTimeout(t,1e3),r.forEach(e=>byId(e).disabled=!1)})}(),i("24h"),i("1h"),i("15min")})})()</script></head><body><h1><img src="/favicon.ico" alt="sun"> Routeur solaire RBR Magnac <span class="version">)%" VERSION R"%(</span></h1><menu><li><a href="/webserial" target="_blank">Web serial</a></li></menu><div class="flex-container"><div id="instant" class="box"><h2>√Ä l'instant</h2><div class="item"><label>Dernier reboot</label> <b id="last_boot"></b></div><div class="item"><label>Conso totale</label> <b id="ptot">0 W</b></div><div class="item"><label>Conso effective</label> <b id="p2">0 W</b></div><div class="item"><label>Chauffe-eau</label> <b id="p1">0 W</b></div></div><div id="radiateur" class="box"><h2>Contr√¥le radiateur</h2><div class="item"><label for="force_off_radi">Arr√™t forc√©</label> <input type="checkbox" id="force_off_radi" name="force_off_radi"></div><div class="item"><label for="force_on_radi">Marche forc√©e</label> <input type="checkbox" id="force_on_radi" name="force_on_radi"></div><div class="item"><span id="is_on_radi">normalement √©teint</span></div></div><div id="control" class="box"><h2>Contr√¥le chauffe-eau</h2><div class="item"><label for="force_off">Arr√™t forc√©</label> <input type="checkbox" id="force_off" name="force_off"></div><div class="item"><label for="force_on">Marche forc√©e</label> <input type="checkbox" id="force_on" name="force_on"></div><div><label for="hc_on">Marche heure creuse</label> <input type="checkbox" id="hc_on" name="hc_on"></div><div><span id="heures_hphc">20 h 56 ‚Äì¬≠04 h 56</span></div><div><label for="seuil">Seuil</label> <input id="seuil" name="seuil" type="number" min="-500" max="500">&nbsp;W</div></div></div><h2 id="donnees_conso">Donn√©es et consommation</h2><div><label for="ekWh_hp">Heure pleine</label> <b>0.<input type="number" id="ekWh_hp" value="2874"> ‚Ç¨/kWh</b></div><div><label for="ekWh_hc">Heure creuse</label> <b>0.<input type="number" id="ekWh_hc" value="2088"> ‚Ç¨/kWh</b></div><div class="box"><h3>Consommation sur 24 heures</h3><div class="flex-container"><div><div><label>Cumul√© jour</label> <b id="cumul_hp_24h">x.xxx kWh √ó 0.2874 ‚Ç¨/kWh = <span class="cumul">0.00 ‚Ç¨</span></b></div><div><label>Cumul√© nuit</label> <b id="cumul_hc_24h">x.xxx kWh √ó 0.2088 ‚Ç¨/kWh = <span class="cumul">0.00 ‚Ç¨</span></b></div><div><label>Cumul√© total</label> <b id="cumul_tot_24h">x.xxx kWh, <span class="cumul">0.00 ‚Ç¨</span></b></div></div><div><div><label>Chauffe-eau surplus</label> <b id="eco_hp_24h">x.xxx kWh √ó 0.2874 ‚Ç¨/kWh = <span class="eco_hp">0.00 ‚Ç¨</span></b></div><div><label>Chauffe-eau nuit</label> <b id="eco_hc_24h">x.xxx kWh √ó 0.2088 ‚Ç¨/kWh = <span class="eco_hc">0.00 ‚Ç¨</span></b></div><div><label>Auto-consommation</label> <b id="autoconso_24h">(x.xx + x.xx) / x.xx = <span class="eco_hc">x %</span></b></div></div></div><div><canvas id="pltconso_24h"></canvas></div></div><div class="box"><h3>Consommation sur une heure</h3><div class="flex-container"><div><div><label>Cumul√© jour</label> <b id="cumul_hp_1h">x.xxx kWh √ó 0.2874 ‚Ç¨/kWh = <span class="cumul">0.00 ‚Ç¨</span></b></div><div><label>Cumul√© nuit</label> <b id="cumul_hc_1h">x.xxx kWh √ó 0.2088 ‚Ç¨/kWh = <span class="cumul">0.00 ‚Ç¨</span></b></div><div><label>Cumul√© total</label> <b id="cumul_tot_1h">x.xxx kWh, <span class="cumul">0.00 ‚Ç¨</span></b></div></div><div><div><label>Chauffe-eau surplus</label> <b id="eco_hp_1h">x.xxx kWh √ó 0.2874 ‚Ç¨/kWh = <span class="eco_hp">0.00 ‚Ç¨</span></b></div><div><label>Chauffe-eau nuit</label> <b id="eco_hc_1h">x.xxx kWh √ó 0.2088 ‚Ç¨/kWh = <span class="eco_hc">0.00 ‚Ç¨</span></b></div><div><label>Auto-consommation</label> <b id="autoconso_1h">(x.xx + x.xx) / x.xx = <span class="eco_hc">x %</span></b></div></div></div><div><canvas id="pltconso_1h"></canvas></div></div><div class="box"><h3>Consommation sur 15 minutes</h3><div class="flex-container"><div><div><label>Cumul√© jour</label> <b id="cumul_hp_15min">x.xxx kWh √ó 0.2874 ‚Ç¨/kWh = <span class="cumul">0.00 ‚Ç¨</span></b></div><div><label>Cumul√© nuit</label> <b id="cumul_hc_15min">x.xxx kWh √ó 0.2088 ‚Ç¨/kWh = <span class="cumul">0.00 ‚Ç¨</span></b></div><div><label>Cumul√© total</label> <b id="cumul_tot_15min">x.xxx kWh, <span class="cumul">0.00 ‚Ç¨</span></b></div></div><div><div><label>Chauffe-eau surplus</label> <b id="eco_hp_15min">x.xxx kWh √ó 0.2874 ‚Ç¨/kWh = <span class="eco_hp">0.00 ‚Ç¨</span></b></div><div><label>Chauffe-eau nuit</label> <b id="eco_hc_15min">x.xxx kWh √ó 0.2088 ‚Ç¨/kWh = <span class="eco_hc">0.00 ‚Ç¨</span></b></div><div><label>Auto-consommation</label> <b id="autoconso_15min">(x.xx + x.xx) / x.xx = <span class="eco_hc">x %</span></b></div></div></div><div><canvas id="pltconso_15min"></canvas></div></div><div id="ota" class="disabled"><h2>Mise √† jour OTA</h2><b id="ota_text">0 %</b><progress id="ota_progress" max="100" value="0">Pas de mise √† jour en cours.</progress></div></body></html>)%";

}

#endif /* INDEX_MIN_H */
